AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: dev-aws-eks
Parameters:
  NodeEnv:
    Type: String
    Default: dev
  Region:
    Type: String
    Default: ap-southeast-1
  ProjectName:
    Type: String
    Default: mybarber
  LambdaRunTime:
    Type: String
    Default: nodejs14.x
Resources:
  EKSRole:
    Type: AWS::Serverless::Application
    Properties:
      Location: EKSRole/template.yaml
      Parameters:
        NodeEnv:
          Ref: NodeEnv
        Region:
          Ref: Region
        ProjectName:
          Ref: ProjectName
  EKSCustomVPC:
    Type: AWS::Serverless::Application
    Properties:
      Location: EKSCustomVPC/template.yaml
      Parameters:
        NodeEnv:
          Ref: NodeEnv
        Region:
          Ref: Region
        ProjectName:
          Ref: ProjectName
  EKSCluster:
    Type: AWS::Serverless::Application
    Properties:
      Location: EKSCluster/template.yaml
      Parameters:
        NodeEnv:
          Ref: NodeEnv
        Region:
          Ref: Region
        ProjectName:
          Ref: ProjectName
        NodeInstanceRoleArn:
          Fn::GetAtt:
          - EKSRole
          - Outputs.NodeInstanceRoleArn
        eksClusterRoleArn:
          Fn::GetAtt:
          - EKSRole
          - Outputs.eksClusterRoleArn
        ControlPlaneSecurityGroupId:
          Fn::GetAtt:
          - EKSCustomVPC
          - Outputs.ControlPlaneSecurityGroupId
        PublicSubnet01Id:
          Fn::GetAtt:
          - EKSCustomVPC
          - Outputs.PublicSubnet01Id
        PublicSubnet02Id:
          Fn::GetAtt:
          - EKSCustomVPC
          - Outputs.PublicSubnet02Id
